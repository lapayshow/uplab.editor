!function(t){var e={};function a(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(r,n,function(e){return t[e]}.bind(null,n));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a(a.s=0)}([function(t,e,a){a(1),t.exports=a(2)},function(t,e,a){"use strict";function r(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}a.r(e);var n=function(){function t(e,a,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._editor=e,this._params=a,this._tag=r||{},this._tag.params=this._tag.params||{},this._tag.params.data=this._tag.params.data||{},this._tag.params.data.attributes=this._tag.params.attributes||{},this.data=this._tag.params.data||{},this.initDialog()}var e,a,n;return e=t,(a=[{key:"initDialog",value:function(){var t,e=this;e._dialog=new BX.CDialog({title:e._params.dialogTitle,icon:"head-block",resizable:!1,width:500,height:310,content_url:e._params.getDialogUrl(e.data.attributes),buttons:[{title:"OK",name:"saveUplabSurrogate",className:"adm-btn-save",id:"saveUplabSurrogate",action:function(){t=e.getSnippetHTML(),e._tag.params.html?e._tag.params.html=t:(console.log("insert",t),e._editor.selection.InsertHTML(t)),setTimeout((function(){e._editor.synchro.FullSyncFromIframe()}),50),this.parentWindow.Close(),$(this.parentWindow.DIV).remove()}},{title:"Еще элемент",className:"adm-btn-add",action:function(){var t=$(".uplab-surrogate-editor-form");$.get(uplabEditorSnippetsParam.dialogUrl+"?ADD",t.serializeArray(),(function(e){t.parent().html(e)}))}},{title:BX.message("JS_CORE_WINDOW_CANCEL"),id:"cancel",name:"cancel",action:function(){this.parentWindow.Close(),$(this.parentWindow.DIV).remove()}}]})}},{key:"getContent",value:function(){}},{key:"refreshContent",value:function(){this._dialog.SetContent(this.getContent())}},{key:"getSnippetHTML",value:function(){var t=this._params.htmlTpl,e=$(".uplab-surrogate-editor-form").serializeArray(),a={},r={};return $.each(e,(function(t,e){var n=e.name.match(/((.+)\[([\w\d_-]*)]|.+)/);e.value&&("TYPE"===n[1]?a[n[1]]=e.value:n[2]?n[3]?r[n[2]][n[3]]=e.value:(r[n[2]]=r[n[2]]||[],r[n[2]].push(e.value)):r[n[1]]=e.value)})),t=(t=t.replace(/#TYPE#/g,a.TYPE||"")).replace(/#VALUES#/g,JSON.stringify(r||""))}},{key:"show",value:function(){this._dialog.Show()}}])&&r(e.prototype,a),n&&r(e,n),t}();function i(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var o=function(){function t(e,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._params=e,this._editor=a,this.initEditorHandler()}var e,a,r;return e=t,(a=[{key:"initEditorHandler",value:function(){this.addEditorParser(),this.addButtons(),this.surrogatesHandlers()}},{key:"addEditorParser",value:function(){var t=this;t._editor.AddCustomParser((function(e){return t._editor.phpParser,e=(e=e||"").replace(t._params.parse.regex,(function(e){var a,r=arguments,n={};return $.each(t._params.parse.attrs,(function(t,e){var a=r[t+1];"VALUES"===e&&(a=JSON.parse(a)),n[e]=a})),n.hasOwnProperty("VALUES")&&n.VALUES&&(n.VALUES.TEMPLATE&&(n.TEMPLATE=n.VALUES.TEMPLATE),n.VALUES.ID&&(n.ID=n.VALUES.ID)),a=t._params.surrogate.getTitle(n),t._editor.phpParser.GetSurrogateHTML(t._params.surrogate.code,a,a,{html:e,attributes:n})||e}))}))}},{key:"addButtons",value:function(){var t=this;t._editor.AddButton({iconClassName:"bxhtmled-button bx-plane-button",src:"/bitrix/images/uplab.editor/i-tools.svg",id:"typograf",title:"typograf",toolbarSort:1,handler:function(e){new n(t._editor,t._params).show()}})}},{key:"surrogatesHandlers",value:function(){var t=this;BX.addCustomEvent("OnGetBxNodeList",(function(t,e){var a=this.phpParser;a.arBxNodes.up_edit_snippet={Parse:function(t){return a._GetUnParsedContent(t.html)}}})),BX.addCustomEvent("OnSurrogateDblClick",(function(e,a){"up_edit_snippet"===a.tag&&void 0!==t._editor.bxTags[a.id]&&new n(t._editor,t._params,a).show()}))}}])&&i(e.prototype,a),r&&i(e,r),t}();window.uplabEditorSnippetsParam={},uplabEditorSnippetsParam.parse={regex:/\[UP_EDITOR_SNIPPET TYPE="([#\w\s._-]*)"](.*?)\[\/UP_EDITOR_SNIPPET]/g,attrs:["TYPE","VALUES"]},uplabEditorSnippetsParam.htmlTpl='[UP_EDITOR_SNIPPET TYPE="#TYPE#"]#VALUES#[/UP_EDITOR_SNIPPET]',uplabEditorSnippetsParam.surrogate={code:"up_edit_snippet",getTitle:function(t){var e="Сниппет [#TYPE##ID##TEMPLATE#]";return e=(e=(e=e.replace(/#TYPE#/,t.TYPE)).replace(/#TEMPLATE#/,t.hasOwnProperty("TEMPLATE")&&t.TEMPLATE?" / ".concat(t.TEMPLATE):"")).replace(/#ID#/,t.hasOwnProperty("ID")&&t.ID?"#".concat(t.ID):"")}},uplabEditorSnippetsParam.dialogUrl="/bitrix/tools/uplab.editor_surrogates_popup.php",uplabEditorSnippetsParam.getDialogUrl=function(t){var e=uplabEditorSnippetsParam.dialogUrl+"?TYPE=#TYPE#&#VALUES#";return e=(e=e.replace(/#TYPE#/,encodeURIComponent(t.TYPE||""))).replace(/#VALUES#/,$.param(t.VALUES||{}))},uplabEditorSnippetsParam.dialogTitle="[Uplab.Editor] Сниппеты",BX.addCustomEvent("OnEditorInitedBefore",(function(){new o(uplabEditorSnippetsParam,this)})),BX.ready((function(){$(document).on("change",".uplab-surrogate-editor-form [data-form-input]",(function(){var t=$(this).closest("form");console.log("array: ",t.serializeArray()),$.get(uplabEditorSnippetsParam.dialogUrl,t.serializeArray(),(function(e){t.parent().html(e)}))}))}))},function(t,e){}]);
//# sourceMappingURL=surrogates.js.map